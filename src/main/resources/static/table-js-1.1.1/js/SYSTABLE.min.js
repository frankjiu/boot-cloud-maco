/*
 * SYSUI-SYSTABLE插件（保留头部可免费使用）
 * 2018-11-26 version1.1
 * 799129700@qq.com SYSHUXL-化海天堂
 * Reserved head available commercial use
 * Universal background system interface framework
 * table表格功能 （排序，checkbox全选，表格列宽拖拽，按钮操作,分页）
 */
function extend(b,c,a){for(var d in c)!c.hasOwnProperty(d)||b.hasOwnProperty(d)&&!a||(b[d]=c[d]);return b}function TAB$(b){return document.getElementById(b)}function TABLAYER$(b){return document.createElement(b)}function SYSTableSorter(b){this._initial(b)}
SYSTableSorter.prototype={constructor:this,_initial:function(b){this.par=extend({TableName:"",btnArea:"",paginName:"",curPage:1,Sequence:[],RightClick:!1,ViewState:[],Callback:function(){},DeleteEvent:function(){},ModifyEvent:function(){},DetailedEvent:function(){},SaveEvent:function(){},CheckboxDeleteEvent:function(){},SearchEvent:function(){}},b,!0);this.hasClass=function(c,a){return!!c.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))};this.addClass=function(c,a){this.hasClass(c,a)||(c.className+=
" "+a)};this.removeClass=function(c,a){this.hasClass(c,a)&&(c.className=c.className.replace(new RegExp("(\\s|^)"+a+"(\\s|$)")," "))};this.getByClass=function(c,a){var b=[];c=c.getElementsByTagName("*");for(i=0;i<c.length;i++)c[i].className==a&&b.push(c[i]);return b};this.show(this.par)},show:function(b){for(var c=this,a=TAB$(b.TableName),d=TAB$(b.btnArea),e=b.Sequence,f=0;f<a.rows[0].cells.length;f++)b.ViewState[f]=!1;if(null!=e&&1<e.length)for(f=1;f<e.length;f++)e[f]>a.rows[0].cells.length||(b=TABLAYER$("em"),
c.addClass(b,"NormalCss"),a.rows[0].cells[e[f]].appendChild(b),a.rows[0].cells[e[f]].onclick=function(){for(var b=1;b<e.length;b++)c.onSequence(a,e[b])},a.rows[0].cells[e[f]].style.cursor="pointer");for(f=0;f<a.rows[0].cells.length;f++)a.rows[0].cells[f].getElementsByTagName("input")[f]?a.rows[0].cells[f].onclick=function(b){for(b=0;b<a.rows[0].cells.length;b++)c.oncheckbox(a,b)}:"",a.rows[0].cells[f].onmousedown=function(b){c.Dragdrop(b,a,void 0,this)},a.rows[0].cells[f].onmouseup=function(b){c.onmouseupDrop(b,
a,void 0,this)},a.rows[0].cells[f].onmousemove=function(b){c.onmousemoveDrop(b,a,void 0,this)};c.callbackf(a,c);c.Selectedbtnmethod(d,a,c)},currentcheckbox:function(b,c){for(var a=1;a<b.rows.length;a++)b.rows[a].cells[0].getElementsByTagName("input")[0]?b.rows[a].cells[0].onclick=function(){for(var a=1;a<b.rows.length;a++)c.onlikecheck(b,a)}:""},callbackf:function(b,c){c.par.Callback(b,c,c.par.curPage);c.ajaxObject(c)},PromptBox:function(b,c){var a=this;if(!document.body.querySelector(".box_Bullet")){var d=
document.createElement("div");document.body.appendChild(d).className="box_Bullet";var e=document.querySelector(".box_Bullet"),f=window.innerWidth;document.body.appendChild(d).innerHTML=b;d.style.cssText="width:"+e.offsetWidth+"px; left:"+(f-e.offsetWidth)/2+"px;margin-top:"+-e.offsetHeight/2+"px";var k=setInterval(function(){c--;a.endclearInterval(c,d,k)},1E3)}},endclearInterval:function(b,c,a){0<b?b--:clearInterval(a);0==b&&(clearInterval(a),document.body.removeChild(c))},ajaxObject:function(b){try{var c=
new XMLHttpRequest}catch(a){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(d){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return b.PromptBox("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301AJAX",2),!1}}}return c},ajaxGet:function(b,c){var a=this,d=a.ajaxObject();d.open("GET",b,!0);d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status){var b=JSON.parse(d.responseText);c(b)}else a.PromptBox("HTTP\u8bf7\u6c42\u9519\u8bef\uff01\u9519\u8bef\u7801\uff1a"+d.status,2)};d.send()},
ajaxPost:function(b,c,a,d){var e=this,f=e.ajaxObject();f.open("post",b,!0);f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status)e.PromptBox(f.responseText,2);else{e.PromptBox("HTTP\u8bf7\u6c42\u9519\u8bef\uff01\u9519\u8bef\u7801\uff1a"+f.status,2);return}e.statusname(f.status,e,a,d)};"undefined"!=typeof c?f.send(c):""},statusname:function(b,c,a,d){if("SaveEvent"==a.name&&404!=b&&200==b){b=c.getByClass(d.parentNode,
"table-edit");for(c=0;c<b.length;c++){var e=b[c].getElementsByTagName("input")[0].value;b[c].innerHTML=e}a.remove();d.innerHTML+="<button class='btn btn-blue padding5' name='ModifyEvent'>\u4fee\u6539</button>"}},Selectedbtnmethod:function(b,c,a){b=b.getElementsByTagName("a")||b.getElementsByTagName("button");for(var d=0;d<b.length;d++)b[d].onclick=function(b){if("DeleteCheckbox"==this.name){b=document.getElementsByName("checkbox");for(var d=c.rows.length,e=c.rows.length-1;1<=e;e--)1==b[e].checked&&
(d=b[e].parentNode.parentNode.parentNode.getAttribute("data-id"),a.par.CheckboxDeleteEvent(a,b[e].parentNode.parentNode.parentNode,d),d=c.rows.length-1);c.rows.length==d&&a.PromptBox("\u8bf7\u9009\u62e9\u4f60\u8981\u5220\u9664\u7684\u4fe1\u606f\uff01",2)}else"searchEvent"==this.name&&((b=this.parentNode.getElementsByTagName("input")[0].value)?a.par.SearchEvent(a,b):a.PromptBox("\u8bf7\u8f93\u5165\u67e5\u8be2\u5173\u952e\u5b57\uff01",2))}},BtnoperationMethod:function(b,c){for(var a=1;a<b.rows.length;a++)for(var d=
1;d<b.rows[a].cells.length;d++)b.rows[a].cells[d].getElementsByTagName("button")||b.rows[a].cells[d].getElementsByTagName("a"),b.rows[a].cells[d].onclick=function(a){a=a||window.event;a=a.target||a.srcElement;if("button"==a.tagName.toLowerCase()||"a"==a.tagName.toLowerCase()){var d=a.name,e=this.parentNode.getAttribute("data-id");c.btnclick(b,e,this,d,a)}}},btnclick:function(b,c,a,d,e){"deleteEvent"==d?this.par.DeleteEvent(a,this,c):"modifyEvent"==d?(this.ModifyMethod(b,c,a,d,e),this.par.ModifyEvent(a,
this,c)):"detailedEvent"==d?this.par.DetailedEvent(a,this,c):"SaveEvent"==d&&this.SaveMethod(b,c,a,this,e)},ModifyMethod:function(b,c,a,d,e){b=this.getByClass(a.parentNode,"table-edit");if(0!=b){for(c=0;c<b.length;c++)d=b[c].getAttribute("data-value"),b[c].innerHTML="<input type='text' class='edit-text' value='"+b[c].innerText+"' name='"+d+"' />";e.remove();a.innerHTML+="<button class='btn btn-blue padding5' name='SaveEvent'>\u4fdd\u5b58</button>"}else this.PromptBox("\u62b1\u6b49\uff0c\u4e0d\u652f\u6301\u76f4\u63a5\u4fee\u6539\u4fe1\u606f\uff0c\u8bf7\u70b9\u51fb\u8be6\u7ec6\u8fdb\u884c\u64cd\u4f5c",
2)},pageTableMethod:function(b,c,a,d,e){var f=this,k=TAB$(f.par.TableName),g=TAB$(f.par.paginName);if(g){var m=g.appendChild(TABLAYER$("ul")),l=document.getElementsByName("page-number")[0];if(l)if(e=[],l=document.getElementsByName("page-number"),c<d){for(g=Math.min(d,a);g;)e.unshift(g--);for(g=0;g<l.length-1;g++){var h=l[g].parentNode.getElementsByTagName("span")[0];h&&(h.style.cssText="display:block;");f.getPage(c);h=parseInt(l[g].getAttribute("data-pages"));l[g].setAttribute("data-pages",e[g]);
l[g].innerHTML=e[g];h=parseInt(l[g].innerHTML);h==c?f.addClass(l[g],"active"):f.removeClass(l[g],"active")}}else{if(1<a-c){h=c-1-Math.floor(d/2);g=d;for(h>a-d&&(h=a-d+1);g--;)e.push(h++);for(g=0;g<l.length-1;g++){if(h=l[g].parentNode.getElementsByTagName("span")[0])h.style.cssText="display:none;";h=parseInt(l[g].getAttribute("data-pages"));l[g].setAttribute("data-pages",e[g]);l[g].innerHTML=e[g];h=parseInt(l[g].innerHTML);h==c?f.addClass(l[g],"active"):f.removeClass(l[g],"active")}}}else{f.firstPage(m,
c,b,a);f.lastPage(m,c,b);for(g=0;g<a;g++){var n=TABLAYER$("li");h=document.createAttribute("name");h.nodeValue="page-number";n.setAttributeNode(h);g==c-1?n.className+=" active":(f.addClass(n,"pages"),f.getPage(c));n.innerHTML=g+1;h=document.createAttribute("data-pages");h.nodeValue=g+1;n.setAttributeNode(h);m.appendChild(n)}l=document.getElementsByName("page-number");for(g=0;g<l.length;g++){for(h=5;h<l.length;h++){if(l.length==a){var p=TABLAYER$("span");f.addClass(p,"ellipsis");p.innerHTML="...";
m.appendChild(p)}l[h].remove();n.innerHTML=a;f.removeClass(n,"pages");f.addClass(n,"mantissa");m.appendChild(n)}l[g].index=g;l[g].onclick=function(c){for(var e=0;e<l.length;e++){if(f.hasClass(n,"mantissa"))var g=parseInt(n.getAttribute("data-pages"));index=c.target.index;var h=parseInt(l[index].getAttribute("data-pages"));parseInt(l[e].getAttribute("data-pages"))==h?f.addClass(l[e],"active"):f.removeClass(l[e],"active");1<g-h&&f.getPages(m,h,a,d)}f.par.Callback(k,f,h);c=document.getElementsByName("Pre-page")[0];
f.lastPage(m,h,b,c);c=document.getElementsByName("Next-page")[0];f.nextPage(m,h,a,b,c)}}f.nextPage(m,c,a,b);f.finalPage(m,c,a,b);f.showPageTotal(m,a,e)}}},getPage:function(b){},firstPage:function(b,c,a,d){var e=this,f=TAB$(e.par.TableName),k=TABLAYER$("li");k.innerHTML="\u9996\u9875";b.appendChild(k);k.onclick=function(){c=1;e.getPage(e.curPage);e.par.Callback(f,e,c);e.addClass(k,"active");var g=document.getElementsByName("last-page")[0];e.removeClass(g,"active");g=document.getElementsByName("Pre-page")[0];
e.lastPage(b,c,a,g);g=document.getElementsByName("Next-page")[0];e.nextPage(b,c,d,a,g);b.remove()};var g=document.createAttribute("name");g.nodeValue="home-page";k.setAttributeNode(g)},lastPage:function(b,c,a,d){var e=this,f=TAB$(e.par.TableName);a=document.getElementsByName("page-number");var k=TABLAYER$("li");if(d)if(1<parseInt(c))d.onclick=function(){c=parseInt(c-1);0<c&&(e.par.Callback(f,e,c),e.getPage(e.curPage));1==c&&e.addClass(d,"disabled")},e.removeClass(d,"disabled");else{for(b=0;b<a.length;b++)k=
parseInt(a[b].getAttribute("data-pages")),c!=k&&e.removeClass(a[b],"active");e.addClass(d,"disabled")}else k.innerHTML="<",1==parseInt(c)&&(k.className="disabled"),a=document.createAttribute("name"),a.nodeValue="Pre-page",k.setAttributeNode(a),b.appendChild(k)},getPages:function(b,c,a,d){b=[];if(c<=a)if(c<d)for(c=Math.min(d,a);c;)b.unshift(c--);else{var e=c-Math.floor(d/2);c=d;for(e>a-d&&(e=a-d+1);c--;)b.push(e++)}else this.PromptBox("\u5f53\u524d\u9875\u6570\u4e0d\u80fd\u5927\u4e8e\u603b\u9875\u6570",
2);d||this.PromptBox("\u663e\u793a\u9875\u6570\u4e0d\u80fd\u4e3a\u7a7a\u6216\u80050",2);return b},Pagination:function(b,c,a,d){a=document.getElementsByName("page-number");TAB$(d.par.paginName);for(d=0;d<a.length-1;d++){var e=TABLAYER$("li");a[d].innerHTML=c[d];b.appendChild(e)}},nextPage:function(b,c,a,d,e){var f=this,k=TAB$(f.par.TableName),g=TABLAYER$("li"),m=document.getElementsByName("page-number");if(e)if(parseInt(c+1)<parseInt(a))f.removeClass(e,"disabled");else{for(b=0;b<m.length;b++)d=parseInt(m[b].getAttribute("data-pages")),
c==d&&f.addClass(m[b],"active");f.addClass(e,"disabled")}else g.innerHTML=">",parseInt(c+1)<parseInt(a)?g.onclick=function(){for(var b=0;b<m.length-1;b++)if(f.hasClass(m[b],"active"))var c=parseInt(m[b].getAttribute("data-pages"));c=parseInt(c+1);c>=a-1?g.className="disabled":(f.par.Callback(k,f,c),f.getPage(f.curPage),b=document.getElementsByName("Pre-page")[0],f.removeClass(b,"disabled"))}:g.className="disabled",c=document.createAttribute("name"),c.nodeValue="Next-page",g.setAttributeNode(c),b.appendChild(g)},
showPageTotal:function(b,c,a){var d=TABLAYER$("li");d.innerHTML="\u5171&nbsp"+c+"&nbsp\u9875";d.className="totalPage";b.appendChild(d);c=TABLAYER$("li");c.innerHTML="\u5408\u8ba1&nbsp"+a+"&nbsp\u6761";c.className="totalPage";b.appendChild(c)},finalPage:function(b,c,a,d){var e=this,f=TAB$(e.par.TableName),k=TABLAYER$("li");k.innerHTML="\u5c3e\u9875";b.appendChild(k);TAB$(e.par.paginName);k.onclick=function(){var c=parseInt(a);e.getPage(c);e.par.Callback(f,e,c);e.addClass(k,"active");var m=document.getElementsByName("home-page")[0];
e.removeClass(m,"active");m=document.getElementsByName("Pre-page")[0];e.lastPage(b,c,d,m);m=document.getElementsByName("Next-page")[0];e.nextPage(b,c,a,d,m);b.remove()};c=document.createAttribute("name");c.nodeValue="last-page";k.setAttributeNode(c)},SaveMethod:function(b,c,a,d,e){b="";for(var f=a.parentNode.getElementsByTagName("td"),k=0;k<f.length;k++)if(d.hasClass(f[k],"table-edit")){var g=f[k].getElementsByTagName("input")[0].name,m=f[k].getElementsByTagName("input")[0].value;b+=g+"="+m+"&"}d.par.SaveEvent(a,
d,c,b,e)},onSequence:function(b,c){for(var a=!0,d=[],e=1;e<b.rows.length;e++)d[e-1]=[b.rows[e].cells[c].innerHTML,e],a=a&&this.IsNumeric(d[e-1][0]);if(a)for(e=0;e<d.length;e++)for(a=e+1;a<d.length;a++){if(parseFloat(d[a][0])<parseFloat(d[e][0])){var f=d[e];d[e]=d[a];d[a]=f}}else d.sort();this.par.ViewState[c]?(d.reverse(),this.par.ViewState[c]=!1,this.addClass(b.rows[0].cells[c].lastChild,"SortDescCss")):(this.par.ViewState[c]=!0,this.removeClass(b.rows[0].cells[c].lastChild,"SortAscCss"));f=[];for(e=
0;e<d.length;e++)f[e]=this.GetRowHtml(b.rows[d[e][1]]);for(e=1;e<b.rows.length;e++)for(a=0;a<b.rows[e].cells.length;a++)b.rows[e].cells[a].innerHTML=f[e-1][a];this.OnSorted(b.rows[0].cells[c],this.par.ViewState[c])},onlikecheck:function(b,c){for(var a=0;a<b.rows[0].cells.length;a++){var d=b.rows[0].cells[a].getElementsByTagName("input")[a];d&&1==d.checked&&(d?d.checked=!1:"");var e=b.rows[c].cells[0].getElementsByTagName("input")[a];if(e)for(1==e.checked?this.addClass(b.rows[c],"active"):b.rows[c].className=
"",a=1;a<b.rows.length;a++)b.querySelectorAll(".active").length==b.rows.length-1&&(d?d.checked=!0:"")}},oncheckbox:function(b,c){for(var a=1;a<b.rows.length;a++)for(var d=b.rows[a].cells[c].getElementsByTagName("input")[c],e=0;e<b.rows[0].cells.length;e++){var f=b.rows[0].cells[e].getElementsByTagName("input")[e];f&&(0==f.checked?(d?d.checked=!1:"",b.rows[a].className=""):(d?d.checked=!0:"",b.rows[a].className="active"))}},Dragdrop:function(b,c,a,d){a=c.rows[0].cells[d.cellIndex];b.offsetX>a.offsetWidth-
10&&(a.mouseDown=!0,a.oldX=b.x,a.oldWidth=a.offsetWidth)},onmouseupDrop:function(b,c,a,d){b=d.cellIndex;void 0==a&&(a=c.rows[0].cells[b]);a.mouseDown=!1;a.style.cursor="default"},onmousemoveDrop:function(b,c,a,d){d=d.cellIndex;c.rows[0].cells[d].style.cursor=b.offsetX>c.rows[0].cells[d].offsetWidth-5?"e-resize":"default";void 0==a&&(a=c.rows[0].cells[d]);if(null!=a.mouseDown&&1==a.mouseDown){a.style.cursor="default";0<a.oldWidth+(b.x-a.oldX)&&(a.width=a.oldWidth+(b.x-a.oldX));a.style.width=a.width;
a.style.cursor="e-resize";for(table=a;"TABLE"!=table.tagName;)table=table.parentElement;for(j=0;j<table.rows.length;j++)table.rows[j].cells[a.cellIndex].width=a.width}},GetRowHtml:function(b){for(var c=[],a=0;a<b.cells.length;a++)c[a]=b.cells[a].innerHTML;return c},OnSorted:function(b,c){},IsNumeric:function(b){return/^\d+(\.\d+)?$/.test(b)}};